<html>
<head data-sly-include="${'/apps/pantheon/partials/header.html'}">
</head>
<body>

<div class="container-fluid" data-sly-use.moduleData="com.redhat.pantheon.use.ModuleData">
    <h1>All Modules</h1>

    <p>
        <a class="btn btn-primary" href="/modules.add.html">New Module</a>
    </p>

    <table id="myTable">
        <tr>
            <th width="200px"><a href="#" onclick="sortTable(0)">Name</a></th>
            <th width="325px"><a href="#" onclick="sortTable(1)">Description</th>
            <th><a href="#" onclick="sortTable(2)">Upload Time</a></th>
        </tr>

        <sly data-sly-list="${moduleData.getModulesCreateSort}">
            <tr>
                <td>
                    <a href="${item.name @ prependPath='modules/', addSelectors=['preview']}">${item.jcr:title}</a>
                </td>
                <td>
                    <a href="${item.name @ prependPath='modules/', addSelectors=['preview']}">${item.jcr:description}</a>
                </td>
                <td>
                    <sly data-sly-use.date="${'com.redhat.pantheon.use.DateFormatter' @ format='yyyy/MM/dd HH:mm:ss', date=item.jcr:created}">${date.value}</sly>
                </td>
            </tr>
        </sly>
    </table>
</div>

<div data-sly-include="${'/apps/pantheon/partials/footer.html'}">
</div>

<!-- https://www.w3schools.com/howto/howto_js_sort_table.asp -->
<script>
function sortTable(n) {
  table = document.getElementById("myTable");

  var htmlRows = table.rows;
  rows = [];
  origRows = [];
  for (i = 1 ; i < htmlRows.length ; i++) {
    rows[i - 1] = origRows[i - 1] = htmlRows[i];
  }
  rows.sort(function(a, b) {
    var t1, t2;
    if (a.cells[n].firstElementChild == null) {
        t1 = a.cells[n].innerText;
        t2 = b.cells[n].innerText;
    } else {
        t1 = a.cells[n].firstElementChild.innerText;
        t2 = b.cells[n].firstElementChild.innerText;
    }
    if (t1 == t2) { return 0; }
    else if (t1 > t2) { return 1; }
    else { return -1; }
  });

  match = true;
  for (i = 0 ; i < rows.length ; i++) {
    if (rows[i] != origRows[i]) {
      match = false;
      break;
    }
  }
  if (match) {
    rows.reverse()
  }

  tBodyNode = htmlRows[0].parentNode;
  while (tBodyNode.children.length > 1) {
    tBodyNode.removeChild(tBodyNode.children[1]);
  }
  for (i = 0 ; i < rows.length ; i++) {
    tBodyNode.appendChild(rows[i]);
  }
}
</script>

</body>
</html>